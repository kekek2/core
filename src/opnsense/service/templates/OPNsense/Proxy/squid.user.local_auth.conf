
{% set voucher_method = [] %}
{% if helpers.exists('OPNsense.proxy.forward.authentication.method') and  OPNsense.proxy.forward.authentication.method != '' %}
{%      for method in OPNsense.proxy.forward.authentication.method.split(",") %}
{%          if method != "Local Database" %}
{%              for server in helpers.toList('system.authserver') %}
{%                  if server.type == 'voucher' and server.name == method %}
{%                      if voucher_method.append(server) %}
{%                      endif %}
{%                  endif %}
{%              endfor %}
{%          endif %}
{%      endfor %}
# Configure Local User Authentication helper
auth_param basic program /usr/local/etc/inc/squid.auth-user.php
{%      if voucher_method|length > 0 %}
auth_param basic casesensitive on
{%      endif%}
{%      if helpers.exists('OPNsense.proxy.forward.authentication.realm') %}
auth_param basic realm {{OPNsense.proxy.forward.authentication.realm}}
{%      endif %}
{%      if helpers.exists('OPNsense.proxy.forward.authentication.credentialsttl') %}
auth_param basic credentialsttl {{OPNsense.proxy.forward.authentication.credentialsttl}} hours
{%      endif %}
{%      if helpers.exists('OPNsense.proxy.forward.authentication.children') %}
auth_param basic children {{OPNsense.proxy.forward.authentication.children}}
{%      endif %}
# ACL - Local Authorized Users - local_auth
acl local_auth proxy_auth REQUIRED
{% endif %}
