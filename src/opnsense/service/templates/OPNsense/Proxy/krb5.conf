# Autogenerated config. Do not edit manualy.

{% set ldap = [] %}
{% if helpers.exists('OPNsense.proxy.forward.authentication.method') and  OPNsense.proxy.forward.authentication.method != '' %}
{%      for server in helpers.toList('system.authserver') %}
{%              if server.type == 'ldap' and server.name == OPNsense.proxy.forward.authentication.method %}
{%                      if ldap.append(server) %}{% endif %}
{%              endif %}
{%      endfor %}
{% endif %}
{% if ldap|length == 1 and OPNsense.proxy.forward.authentication.EnableKerberos == '1' %}
[libdefaults]
         default_realm = {{ system.domain|upper }}
         dns_lookup_kdc = no
         dns_lookup_realm = no
         ticket_lifetime = 24h
         default_keytab_name = /usr/local/etc/squid/squid.keytab
{% if helpers.exists('OPNsense.proxy.forward.authentication.ADKerberosImplementation') and OPNsense.proxy.forward.authentication.ADKerberosImplementation == 'W2003' %}
	 default_tgs_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
	 default_tkt_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
	 permitted_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
{% else %}
         default_tgs_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc des-cbc-md5
         default_tkt_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc des-cbc-md5
         permitted_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc des-cbc-md5
{% endif %}
[realms]
         {{ system.domain|upper }} = {
                 kdc = {{ ldap[0].host }}
                 admin_server = {{ ldap[0].host }}
                 default_domain = {{ system.domain }}
         }
[domain_realm]
         .{{ system.domain }} = {{ system.domain|upper }}
         {{ system.domain }} = {{ system.domain|upper }}
{% endif %}
